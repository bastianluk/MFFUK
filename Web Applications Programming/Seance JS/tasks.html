<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Project Planner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <style type="text/css">
    #table-body tr.selected {
        background-color: #fff4aa;
    }

    #table-body tr.subselected {
        background-color: #ddff99;
    }
    </style>

    <script type="text/javascript">

    // Example of input data
    var tasks = [
        {
            id: 't1',
            task: 'Smash the anvil',
            assigned: 'Thor',
            parent: null,
        },
        {
            id: 't2',
            task: 'Keep the door closed',
            assigned: 'Heimdall',
            parent: null,
        },
        {
            id: 't3',
            task: 'Rule the Asgard',
            assigned: 'Odin',
            parent: null,
        },
        {
            id: 't2-sub1',
            task: 'Find the key and lock it',
            assigned: 'Freyr',
            parent: 't2',
        },
    ];

    // Some more extensive data (uncomment the following line if you wish to use larger dataset)
    tasks = JSON.parse('[{"task":"Frontend","id":"t01","assigned":"<not yet>","parent":null},{"task":"Kickoff","id":"t01-01","assigned":"<not yet>","parent":"t01"},{"task":"Setup React","id":"t01-01-01","assigned":"<not yet>","parent":"t01-01"},{"task":"Design Redux Structure","id":"t01-01-02","assigned":"<not yet>","parent":"t01-01"},{"task":"Prepare Webpack","id":"t01-01-03","assigned":"Ladislav Pe\u0161ka","parent":"t01-01"},{"task":"Components","id":"t01-02","assigned":"<not yet>","parent":"t01"},{"task":"Main page","id":"t01-02-01","assigned":"Petr \u0160koda","parent":"t01-02"},{"task":"Login form","id":"t01-02-02","assigned":"<not yet>","parent":"t01-02"},{"task":"Products table","id":"t01-02-03","assigned":"Martin Kruli\u0161","parent":"t01-02"},{"task":"Editting form","id":"t01-02-04","assigned":"<not yet>","parent":"t01-02"},{"task":"Dashboard","id":"t01-02-05","assigned":"<not yet>","parent":"t01-02"},{"task":"Analyse graph libraries","id":"t01-02-05-01","assigned":"Petr \u0160koda","parent":"t01-02-05"},{"task":"Prepare feeding data adapters","id":"t01-02-05-02","assigned":"Petr \u0160koda","parent":"t01-02-05"},{"task":"API","id":"t02","assigned":"<not yet>","parent":null},{"task":"Prepare swagger tools","id":"t02-01","assigned":"Martin Kruli\u0161","parent":"t02"},{"task":"Checkout generator plugin","id":"t02-01-01","assigned":"<not yet>","parent":"t02-01"},{"task":"Draft basic CRUD model","id":"t02-02","assigned":"<not yet>","parent":"t02"},{"task":"Extra entrypoints","id":"t02-03","assigned":"<not yet>","parent":"t02"},{"task":"Authentication","id":"t02-03-01","assigned":"Martin Kruli\u0161","parent":"t02-03"},{"task":"Graph data","id":"t02-03-02","assigned":"<not yet>","parent":"t02-03"},{"task":"Permission hints","id":"t02-03-03","assigned":"<not yet>","parent":"t02-03"},{"task":"Backend","id":"t03","assigned":"<not yet>","parent":null},{"task":"Database","id":"t03-01","assigned":"<not yet>","parent":"t03"},{"task":"Setup ORM","id":"t03-01-01","assigned":"<not yet>","parent":"t03-01"},{"task":"Initialize migration system","id":"t03-01-02","assigned":"<not yet>","parent":"t03-01"},{"task":"Import schema from existing app","id":"t03-01-03","assigned":"Ladislav Pe\u0161ka","parent":"t03-01"},{"task":"API adapters","id":"t03-02","assigned":"Petr \u0160koda","parent":"t03"},{"task":"Data processing","id":"t03-03","assigned":"<not yet>","parent":"t03"},{"task":"Compare cloud solutions","id":"t03-03-01","assigned":"<not yet>","parent":"t03-03"},{"task":"Draft required pipelines","id":"t03-03-02","assigned":"Ladislav Pe\u0161ka","parent":"t03-03"}]');

    window.onload = function() {
        var tableBody = document.getElementById('table-body');
        clearTableBody(tableBody)
        renderTable(tableBody, tasks);
        addStyling(tableBody.children);
    };

    function clearTableBody(tableBody)
    {
        while (tableBody.children.length > 0)
        {
          tableBody.removeChild(tableBody.lastChild);
        }
    }

    function renderTable(tableBody, data)
    {
      for (var task of data)
      {
        var taskValues = [task.id, task.task, task.assigned, task.parent];
        addRow(tableBody, taskValues);
      }
    }

    function addRow(tableElement, values)
    {
      var rowElement = document.createElement("tr");
      for (var i = 0; i < values.length; i++)
      {
        var cellElement = document.createElement("td");
        cellElement.textContent = values[i];
        rowElement.appendChild(cellElement);
      }

      tableElement.appendChild(rowElement);
    }

    function addStyling(rows)
    {
        Array.from(rows).forEach(selectedRow => {
            selectedRow.addEventListener("click", function() {
                Array.from(rows).forEach(row => {
                    row.classList.remove("selected");
                    row.classList.remove("subselected");
                })
                styleChange(rows, selectedRow);
            });
        });
        // on click remove styles from all, if is clicked or child of clicked, set correct style
    }

    function styleChange(rows, selectedRow)
    {
        selectedRow.classList.add("selected");
        recursiveStyleChange(rows, selectedRow);
    }

    function recursiveStyleChange(rows, selectedRow)
    {
        Array.from(rows).filter(row => {
            return row.children[3].textContent == selectedRow.children[0].textContent
        }).forEach(row => {
            row.classList.add("subselected");
            recursiveStyleChange(rows, row);
        });
    }

    </script>
</head>

<body class="container">
<h1 class="mt-4 mb-4">Project Planner</h1>

<table class="table table-hover table-striped">
    <thead class="thead-dark">
        <tr>
            <th>ID</th>
            <th>Task Description</th>
            <th>Assigned To</th>
            <th>Parent</th>
        </tr>
    </thead>
    <tbody id="table-body">
        <tr>
            <td>This</td>
            <td>is a </td>
            <td>template</td>
            <td>row</td>
        </tr>
    </tbody>
</table>

</body>

</html>
